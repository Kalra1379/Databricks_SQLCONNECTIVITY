import smtplib, os from email.mime.multipart import MIMEMultipart from email.mime.text import MIMEText from email.mime.base import MIMEBase from email import encoders  # ---------- DB CONFIG ---------- jdbc_url = "jdbc:oracle:thin:@//HOST:PORT/SERVICE" props = {     "user": "DB_USER",     "password": "DB_PASSWORD",     "driver": "oracle.jdbc.driver.OracleDriver" }  query = "(SELECT EMAIL_RECIPIENT FROM EPRRESCRIBING.SP_NEWFX_GET_LOOKUP) t" df = spark.read.jdbc(jdbc_url, query, properties=props) to_emails = ",".join([r.EMAIL_RECIPIENT for r in df.collect()])  # ---------- EMAIL CONFIG ---------- SMTP_SERVER = "smtp.gmail.com" SMTP_PORT = 587 FROM_EMAIL = "your_email@gmail.com" APP_PASSWORD = "xxxx xxxx xxxx xxxx"  msg = MIMEMultipart() msg["From"] = FROM_EMAIL msg["To"] = to_emails msg["Subject"] = "Lib Env EmailEnv - No Files Found"  html_body = """ <!DOCTYPE html> <html> <body> <p>Hello Everyone,</p> <p><b>No files are present in the SFTP location.</b></p> <p>This is a system generated email.</p> </body> </html> """  msg.attach(MIMEText(html_body, "html"))  # ---------- ATTACHMENT ---------- file_path = "/dbfs/FileStore/sample.png" if os.path.exists(file_path):     with open(file_path, "rb") as f:         part = MIMEBase("application", "octet-stream")         part.set_payload(f.read())     encoders.encode_base64(part)     part.add_header("Content-Disposition", f'attachment; filename="sample.png"')     msg.attach(part)  # ---------- SEND ---------- server = smtplib.SMTP(SMTP_SERVER, SMTP_PORT) server.starttls() server.login(FROM_EMAIL, APP_PASSWORD) server.send_message(msg) server.quit()  print("âœ… Email Sent Successfully")
